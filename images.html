<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kindle Screensaver Image Gallery – Community Collection</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A curated gallery of community Kindle screensaver images, organized by author. Download and explore creative Kindle backgrounds, wallpapers, and more.">
  <link rel="canonical" href="https://kindlemodshelf.me/images.html">
  <link rel="stylesheet" href="style.css">
  <meta property="og:title" content="Kindle Screensaver Images – Community Gallery">
  <meta property="og:description" content="A curated gallery of community Kindle screensaver images, organized by author. Download and explore creative Kindle backgrounds, wallpapers, and more.">
  <meta property="og:url" content="https://kindlemodshelf.me/images.html">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700&display=swap" rel="stylesheet">
  <script src="theme-toggle.js"></script>
</head>
<body>
  <div class="container">
    <a href="index.html" class="back-home-btn" aria-label="Back to Home">← Back to Home</a>
    <h1>Kindle Screensaver Image Gallery</h1>
    <div class="summary">
      Browse and download user-contributed Kindle screensaver images, organized by author. Click any image to view it large, or use the download icon in the preview to save.
    </div>
    <div class="search-bar-wrap">
      <label for="search-bar" class="search-label">Search by author:</label>
      <input type="text" id="search-bar" placeholder="Type an author name…" autocomplete="off">
    </div>
    <div id="gallery-root"></div>
    <div id="loading-indicator" style="text-align: center; margin: 20px 0; display: none;">
      <div class="loader"></div>
      <p>Loading more authors...</p>
    </div>

    <!-- Hidden canvas for thumbnail generation -->
    <canvas id="thumbnail-canvas" width="300" height="300"></canvas>

    <!-- Modal Viewer -->
    <div id="img-viewer-modal">
      <div id="img-viewer-img-wrap">
        <div class="viewer-topbar">
          <div class="viewer-info">
            <span id="img-viewer-author"></span>
            <span id="img-viewer-filename"></span>
          </div>
          <div class="viewer-actions">
            <a id="img-viewer-download" class="viewer-button viewer-download" href="#" download>
              <svg width="21" height="21" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <path d="M10 3v10m0 0l-4-4m4 4l4-4M4 17h12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>Download</span>
            </a>
            <button id="img-viewer-close" class="viewer-button viewer-close" type="button">Close</button>
          </div>
        </div>
        <div class="viewer-canvas">
          <div id="img-viewer-loader"></div>
          <img id="img-viewer-img" src="" alt="Large view" draggable="false">
        </div>
      </div>
    </div>
  </div>
    <script>
    const INITIAL_AUTHORS = 10;
    const LOAD_MORE_AUTHORS = 6;
    const PREVIEW_IMAGE_COUNT = 8;
    const THUMBNAIL_WIDTH = 520;
    const THUMBNAIL_HEIGHT = 520;
    const THUMBNAIL_QUALITY = 0.82;
    const PLACEHOLDER_SRC = 'data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=';
    const SECTION_UNLOAD_OFFSET = 1400;
    const MAX_CACHE_ITEMS = 60;
    const PLACEHOLDER_BACKGROUND = 'linear-gradient(160deg, rgba(88, 225, 255, 0.18), rgba(12, 20, 34, 0.92))';
    const CANVAS_BACKGROUND = '#081524';

    let allAuthors = [];
    let allData = null;
    let loadedAuthors = 0;
    let isLoading = false;
    let isSearchMode = false;

    const thumbnailCache = new Map();
    const sectionsMeta = new Map();

    const galleryRoot = document.getElementById('gallery-root');
    const loadingIndicator = document.getElementById('loading-indicator');
    const thumbnailCanvas = document.getElementById('thumbnail-canvas');
    const thumbnailCtx = thumbnailCanvas.getContext('2d');

    const imageObserver = new IntersectionObserver(handleImageIntersection, {
      root: null,
      rootMargin: '600px 0px 600px 0px',
      threshold: 0.1
    });

    const sectionObserver = new IntersectionObserver(handleSectionIntersection, {
      root: null,
      rootMargin: '800px 0px 800px 0px',
      threshold: 0.05
    });

    let scrollEnabled = false;

    fetch('images.json')
      .then(res => {
        if (!res.ok) throw new Error('Could not load images.json');
        return res.json();
      })
      .then(data => {
        allData = data;
        allAuthors = Object.keys(data).sort((a, b) => a.localeCompare(b, 'en', { sensitivity: 'base' }));
        if (allAuthors.length === 0) {
          galleryRoot.textContent = 'No images found.';
          return;
        }
        enableScrollLoading();
        loadMoreAuthors(INITIAL_AUTHORS);

        const searchBar = document.getElementById('search-bar');
        searchBar.addEventListener('input', handleSearch);
      })
      .catch(error => {
        console.error('Error loading gallery:', error);
        galleryRoot.textContent = 'Could not load image list. Please contact the site owner.';
      });

    function handleSearch(event) {
      const query = event.target.value.trim().toLowerCase();
      resetGallery();
      loadingIndicator.style.display = 'none';

      if (query === '') {
        isSearchMode = false;
        enableScrollLoading();
        loadMoreAuthors(INITIAL_AUTHORS);
        return;
      }

      isSearchMode = true;
      disableScrollLoading();

      const matches = allAuthors.filter(author => author.toLowerCase().includes(query));
      if (matches.length === 0) {
        const msg = document.createElement('div');
        msg.className = 'no-results';
        msg.textContent = 'No authors match your search.';
        galleryRoot.appendChild(msg);
        return;
      }

      matches.forEach(author => createSection(author));
    }

    function handleScroll() {
      if (isSearchMode || isLoading || loadedAuthors >= allAuthors.length) return;
      const scrollY = window.scrollY;
      const windowHeight = window.innerHeight;
      const documentHeight = document.documentElement.scrollHeight;
      if (scrollY + windowHeight > documentHeight - 200) {
        loadMoreAuthors(LOAD_MORE_AUTHORS);
      }
    }

    function loadMoreAuthors(count) {
      if (isSearchMode || isLoading || loadedAuthors >= allAuthors.length) return;

      isLoading = true;
      loadingIndicator.style.display = 'block';

      const endIndex = Math.min(loadedAuthors + count, allAuthors.length);
      setTimeout(() => {
        for (let i = loadedAuthors; i < endIndex; i++) {
          const author = allAuthors[i];
          const images = allData[author];
          if (!Array.isArray(images) || images.length === 0) continue;
          createSection(author);
        }
        loadedAuthors = endIndex;
        isLoading = false;
        loadingIndicator.style.display = 'none';
        if (loadedAuthors >= allAuthors.length) {
          disableScrollLoading();
        }
      }, 40);
    }

    function createSection(author) {
      const images = allData[author];
      if (!Array.isArray(images) || images.length === 0) return;

      const sectionId = sanitizeId(author);
      const section = document.createElement('section');
      section.dataset.author = author;
      section.setAttribute('aria-labelledby', sectionId);
      section.innerHTML = `
        <h2 class="section-title" id="${sectionId}">${author}</h2>
        <div class="card card-desc gallery-card">
          <div class="gallery-grid" id="grid-${sectionId}"></div>
          <div class="gallery-controls" id="controls-${sectionId}"></div>
        </div>
      `;

      galleryRoot.appendChild(section);

      const meta = {
        author,
        section,
        grid: section.querySelector('.gallery-grid'),
        controls: section.querySelector('.gallery-controls'),
        rendered: false
      };

      sectionsMeta.set(author, meta);
      sectionObserver.observe(section);

      if (isSectionNearViewport(section) || isSearchMode) {
        ensureSectionRendered(meta);
      }
    }

    function addImageToGrid(grid, author, filename) {
      const imgFullPath = `images/${author}/${filename}`;
      const cell = document.createElement('div');
      cell.className = 'img-thumb-wrap';

      const img = document.createElement('img');
      img.className = 'img-thumb';
      img.alt = '';
      img.loading = 'lazy';
      img.decoding = 'async';
      img.dataset.loaded = '0';
      img.dataset.loading = '0';
      img.dataset.fullPath = imgFullPath;
      img.dataset.author = author;
      img.dataset.filename = filename;
      img.src = PLACEHOLDER_SRC;
      img.style.background = PLACEHOLDER_BACKGROUND;

      img.addEventListener('click', function () {
        if (this.dataset.loaded !== '1') {
          loadImage(this);
        }
        openViewer(this);
      });

      cell.appendChild(img);
      grid.appendChild(cell);
      imageObserver.observe(img);
    }

    function createThumbnail(imgPath, callback) {
      if (thumbnailCache.has(imgPath)) {
        callback(thumbnailCache.get(imgPath));
        return;
      }

      const originalImg = new Image();
      originalImg.crossOrigin = 'anonymous';

      originalImg.onload = function () {
        thumbnailCanvas.width = THUMBNAIL_WIDTH;
        thumbnailCanvas.height = THUMBNAIL_HEIGHT;
        thumbnailCtx.imageSmoothingEnabled = true;
        thumbnailCtx.imageSmoothingQuality = 'high';

        thumbnailCtx.fillStyle = CANVAS_BACKGROUND;
        thumbnailCtx.fillRect(0, 0, THUMBNAIL_WIDTH, THUMBNAIL_HEIGHT);

        const aspectRatio = originalImg.width / originalImg.height;
        let drawWidth = THUMBNAIL_WIDTH;
        let drawHeight = THUMBNAIL_WIDTH / aspectRatio;

        if (drawHeight > THUMBNAIL_HEIGHT) {
          drawHeight = THUMBNAIL_HEIGHT;
          drawWidth = THUMBNAIL_HEIGHT * aspectRatio;
        }

        const x = (THUMBNAIL_WIDTH - drawWidth) / 2;
        const y = (THUMBNAIL_HEIGHT - drawHeight) / 2;

        thumbnailCtx.drawImage(originalImg, x, y, drawWidth, drawHeight);

        try {
          const thumbnailUrl = thumbnailCanvas.toDataURL('image/jpeg', THUMBNAIL_QUALITY);
          thumbnailCache.set(imgPath, thumbnailUrl);
          if (thumbnailCache.size > MAX_CACHE_ITEMS) {
            const oldestKey = thumbnailCache.keys().next().value;
            thumbnailCache.delete(oldestKey);
          }
          callback(thumbnailUrl);
        } catch (e) {
          console.warn('Could not generate thumbnail for', imgPath, e);
          callback(imgPath);
        }
      };

      originalImg.onerror = function () {
        console.warn('Could not load image:', imgPath);
        callback(imgPath);
      };

      originalImg.src = imgPath;
    }

    function loadImage(img) {
      if (img.dataset.loaded === '1' || img.dataset.loading === '1') return;
      img.dataset.loading = '1';
      const imgPath = img.dataset.fullPath;

      const applyThumbnail = thumbnailUrl => {
        if (!img.isConnected || img.dataset.loading !== '1') return;
        img.src = thumbnailUrl;
        img.dataset.loaded = '1';
        img.dataset.loading = '0';
        img.classList.add('loaded');
      };

      if (thumbnailCache.has(imgPath)) {
        applyThumbnail(thumbnailCache.get(imgPath));
        return;
      }

      createThumbnail(imgPath, applyThumbnail);
    }

    function unloadImage(img) {
      if (img.dataset.loaded !== '1') return;
      img.dataset.loaded = '0';
      img.dataset.loading = '0';
      img.src = PLACEHOLDER_SRC;
      img.classList.remove('loaded');
    }

    function handleImageIntersection(entries) {
      const viewportHeight = window.innerHeight || document.documentElement.clientHeight;
      entries.forEach(entry => {
        const img = entry.target;
        if (entry.isIntersecting) {
          loadImage(img);
          return;
        }

        const rect = entry.boundingClientRect;
        const aboveThreshold = rect.bottom < -SECTION_UNLOAD_OFFSET;
        const belowThreshold = rect.top > viewportHeight + SECTION_UNLOAD_OFFSET;

        if (aboveThreshold || belowThreshold) {
          unloadImage(img);
        }
      });
    }

    function ensureSectionRendered(meta) {
      if (meta.rendered) return;
      const images = allData[meta.author] || [];
      if (!images.length) return;

      // Show all images from the start
      images.forEach(filename => addImageToGrid(meta.grid, meta.author, filename));

      meta.rendered = true;
    }

    function createLoadMoreButton(meta, images) {
      const btn = document.createElement('button');
      btn.className = 'load-more-btn';
      btn.type = 'button';
      btn.textContent = `Show all ${images.length} images`;
      btn.addEventListener('click', () => {
        const currentCount = meta.grid.querySelectorAll('.img-thumb-wrap').length;
        images.slice(currentCount).forEach(filename => addImageToGrid(meta.grid, meta.author, filename));
        meta.expanded = true;
        btn.remove();
        meta.loadMoreBtn = null;
      });
      return btn;
    }

    function teardownSection(meta) {
      if (!meta.rendered) return;
      const thumbs = meta.grid.querySelectorAll('.img-thumb');
      thumbs.forEach(img => imageObserver.unobserve(img));
      meta.grid.innerHTML = '';
      meta.rendered = false;
    }

    function handleSectionIntersection(entries) {
      const viewportHeight = window.innerHeight || document.documentElement.clientHeight;
      entries.forEach(entry => {
        const author = entry.target.dataset.author;
        const meta = sectionsMeta.get(author);
        if (!meta) return;

        if (entry.isIntersecting) {
          ensureSectionRendered(meta);
          return;
        }

        const rect = entry.boundingClientRect;
        if (rect.bottom < -SECTION_UNLOAD_OFFSET || rect.top > viewportHeight + SECTION_UNLOAD_OFFSET) {
          teardownSection(meta);
        }
      });
    }

    function isSectionNearViewport(section) {
      const buffer = 800;
      const rect = section.getBoundingClientRect();
      const viewportHeight = window.innerHeight || document.documentElement.clientHeight;
      return rect.top <= viewportHeight + buffer && rect.bottom >= -buffer;
    }

    function sanitizeId(str) {
      return str.replace(/[^a-zA-Z0-9_\-.]/g, '_');
    }

    function resetGallery() {
      sectionsMeta.forEach(meta => {
        sectionObserver.unobserve(meta.section);
        teardownSection(meta);
      });
      sectionsMeta.clear();
      galleryRoot.innerHTML = '';
      imageObserver.disconnect();
      sectionObserver.disconnect();
      loadedAuthors = 0;
      isLoading = false;
    }

    function enableScrollLoading() {
      if (scrollEnabled) return;
      window.addEventListener('scroll', handleScroll);
      scrollEnabled = true;
    }

    function disableScrollLoading() {
      if (!scrollEnabled) return;
      window.removeEventListener('scroll', handleScroll);
      scrollEnabled = false;
    }

    const modal = document.getElementById('img-viewer-modal');
    const modalImg = document.getElementById('img-viewer-img');
    const modalDownload = document.getElementById('img-viewer-download');
    const modalClose = document.getElementById('img-viewer-close');
    const modalAuthor = document.getElementById('img-viewer-author');
    const modalFilename = document.getElementById('img-viewer-filename');
    const modalLoader = document.getElementById('img-viewer-loader');

    function openViewer(thumbnail) {
      modal.style.display = 'flex';
      modal.classList.remove('active');
      modalLoader.classList.add('active');
      modalImg.style.opacity = '0';

      const src = thumbnail.dataset.fullPath;
      const author = thumbnail.dataset.author || 'Unknown Author';
      const filename = thumbnail.dataset.filename || '';

      modalAuthor.textContent = author;
      modalFilename.textContent = filename;
      modalDownload.href = src;
      if (filename) {
        modalDownload.download = filename;
      }

      modalImg.onload = function () {
        modalLoader.classList.remove('active');
        modalImg.style.opacity = '1';
        requestAnimationFrame(() => modal.classList.add('active'));
      };

      modalImg.onerror = function () {
        modalLoader.classList.remove('active');
        modalImg.style.opacity = '1';
      };

      modalImg.src = src;
      requestAnimationFrame(() => modal.classList.add('active'));
    }

    function closeViewer() {
      modal.classList.remove('active');
      setTimeout(() => {
        modal.style.display = 'none';
        modalImg.src = '';
        modalDownload.href = '#';
        modalLoader.classList.remove('active');
      }, 200);
    }

    modalClose.onclick = closeViewer;
    modal.onclick = event => {
      if (event.target === modal) closeViewer();
    };
    document.addEventListener('keydown', event => {
      if (modal.classList.contains('active') && (event.key === 'Escape' || event.key === 'Esc')) {
        closeViewer();
      }
    });
  </script>

    <footer class="legal-disclaimer">Educational purposes only. Not affiliated with Amazon. Users responsible for compliance with applicable laws.</footer>
</body>
</html>
